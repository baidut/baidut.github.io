---
layout: post
category : Computer
tagline: ""
tags : [howto diskpart disk]
---
{% include JB/setup %}

    作为一个搞计算机的童鞋，帮别人的电脑分分区、重做系统是经常有的事。本文旨在介绍一下鄙人对此的一点经验，仅供参考。因水平有限，错误难免，请见谅。

 * 如果你需要快速了解如何进行分区、装系统，直接跳到 [解决方案](#解决方案) 
 * 如果你想了解一下相关的知识，那么就听我慢慢道来：

所谓"授之于鱼不如授之于渔"，本节不会枯燥地讲解如何解决问题，而是以一个不太形象却方便理解的对比引入：

磁盘就像一个国家，我们知道有时候国家大了不方便管理，所以需要分而治之；如果你的国家需要多种管理制度并存，则必然需要**分区**治理。把磁盘上的文件比作人的住所，**分区**使得一个地区的人集居在一起，方便调度（小地区更容易治理），而且不同地区相对独立，某个地区发生了暴乱可以仅治理该地区而不影响其他地区；同时如果要在多个地区之间移民则会遇到一些麻烦（搬迁住所，并在新的地区注册登记）。

操作系统就好比是管理国家的首席大臣，如果不为操作系统文件单独设立一个分区，那么就可能会有诸多的麻烦：

 * 不小心误杀了首席大臣——误删操作系统文件
 * 国家需要改朝换代的时候，如果首席大臣们集中在一个分区，那么直接替换这个分区即可，而不过同在这个分区的还有其他人的话，就麻烦了，如果你不找到这些无辜的人并将它们移动到其他地方去，那么你就可能错杀平民百姓。——重装系统比较麻烦

所以，系统是需要占一个单独的分区的。如果你的电脑是多系统，那么这些系统都需要独立地分配一个分区。 

    我们有必要了解电脑的启动过程。

打开电源首先唤醒的是主板上的BIOS，在进行完一系列检测和配置以后，开始按设定的系统引导顺序引导系统，比如启动顺序清单上写着：U盘、移动硬盘、本地磁盘，那么BIOS就会先试着从U盘启动，再尝试移动硬盘启动，最后前两者都无法启动时再从本地磁盘启动。

从U盘启动可以通过U盘里的系统安装文件把系统安装到本地磁盘里，这样可以方便地重做系统；同时u盘里也可以安装操作系统，让电脑直接访问U盘里的系统，并可以借此操作本地磁盘，得益于windowstogo技术，不仅仅是winpe这类特殊的系统可以装在u盘里，win8/7都支持。当然，u盘可以做的，移动硬盘也可以做。

BIOS的使命就是找到一个可以启动的设备，而设备上必然会有一个区域是启动程序，对于MBR引导的磁盘，这个启动程序就在磁盘第一扇区MBR(主要启动记录区Master Boot Record)，第一扇区还有一个非常重要的东西就是分区表。BIOS找到启动盘后，电脑会载入启动盘MBR里的开机管理程序，通过分区表得到磁盘的分区信息。

**主分区，扩展分区，逻辑分区** 由于用于启动的第一扇区的分区表大小有限，最多只能记录4个分区项，如果要划分4个以上的分区该怎么办呢？考虑到这个问题，我们引入了一个扩展分区，这个扩展分区可以进一步地划分为若干个逻辑分区。4个分区项每个分区项可以是主分区P，也可以是扩展分区L，这样，我们的分区方案就可以是 4P、3P+L、3P、2P+L、2P、P+L、P
记住**总共4项，至少有一个P，至多有一个L**就行了。因为系统分区必须是在主分区

<!-- 事实上，你完全可以将磁盘分出多个主分区供不同操作系统，只是一个操作系统受分区表限制只能读四个主分区，多出来的主分区可以供其他操作系统使用 -->

解决方案
========

windows系统下，无需安装软件，请高调地[以管理员身份打开cmd](电脑基本操作.md#以管理员身份打开cmd)：<!--切换到管理员用户 ctrl+shift点击磁贴 以管理员身份打开 help runas 注意微软账户的密码不管用 是安装windows时设置的用户密码-->
输入diskpart回车
输入help回车获取diskpart使用帮助
输入help 命令 了解某个命令的详细使用方法

相信大多数人都是直接按照网上的方法试就行了，我不推荐这样，你凭什么相信网上的步骤？网上那些发经验的人懂么？
网上的东西只是用来参考的，比如我通过网上可以获知那些工具可以实现磁盘分区，再了解一下别人的实现步骤，然后看这些步骤都做了什么，而不是直接全部傻乎乎地直接照做，磁盘全盘格式化了都不知道，参见[直播小白悲惨世界 已给Diskpart clean命令跪下了](http://tieba.baidu.com/p/2887881245)。

常见情境：

 * PPPP 分区表项已满，不能再创建分区
 * PPPL 扩展分区没有分配完全，后面的空闲空间被浪费 ：选择最后一个卷，extend
 * 磁盘上没有足够的空间进行此操作

<!-- 
参考步骤：

list disk 列出连接到本机的所有硬盘
sel disk 0 选中磁盘0（全称select disk 0）
create par extended 把剩下的未划分空间创建为扩展分区(全称create partition extended)
convert dynamic

/* 假设一块500GB的硬盘
List Disk                                     /* 显示本机的所有磁盘
Select Disk X                                 /* 选择X号磁盘(一个硬盘默认为0，多个硬盘请选择编号)
Clean                                         /* 清除磁盘上所有的内容
Create Partition Primary Size=51208           /* 创建主分区容量为50G
Active                                        /* 激活主分区
 
/* 以下是格式化分区命令，三种任选一种
Format Quick                                  /* 快速格式化分区，默认为NTFS格式
Format FS=NTFS Quick                          /* 分区格式为NTFS并快速格式化
Format FS=FAT32 Quick                         /* 分区格式为FAT32并快速格式化
/* 以上是格式化分区命令，三种任选一种
 
Create Partition Extended                     /* 创建扩展分区
Create Partition Logical Size=102407          /* 创建逻辑分区一 容量为100G
Foramt Quick                                  /* 快速格式化分区
Create Partition Logical Size=153606          /* 创建逻辑分区二 容量为150G
Foramt Quick                                  /* 快速格式化分区
Create Partition Logical                      /* 创建逻辑分区三 容量为剩余空间
Foramt Quick                                  /* 快速格式化分区
Exit                                          /* 退出 Diskpart
Exit                                          /* 退出命令提示符环境
 -->

参考资料
========

 * [硬盘分区表知识——详解硬盘MBR](http://www.blogjava.net/galaxyp/archive/2010/04/25/319344.html)
 * 《鸟哥的linux私房菜》
 * [DiskPart使用方法（ZT）](http://www.cnblogs.com/samcn/archive/2011/01/10/1931637.html)
 * [使用diskpart工具划分扩展分区的详细步骤](http://support1.lenovo.com.cn/lenovo/wsi/htmls/detail_20131016145015277.html)

扩展阅读
========

 * [【讨论】Windows启动过程(MBR分析)](http://bbs.pediy.com/showthread.php?t=178914)
 * 《30天自制操作系统》
 * 《ORANGE'S：一个操作系统的实现》

<!--

做一件事最好先设置一个deadline

**TODO**

-[ ] 查看mbr
-[ ] 调研GPT磁盘
-[ ] 追加linux相关知识
-[ ] 调研从U盘启动和从移动硬盘启动的差异
-[ ] 自制操作系统，这样就可以更加深入的理解

MBR（Main Boot Record 主引导记录区）位于整个硬盘的0磁道0柱面1扇区。不过，在总共512字节的主引导扇区中，MBR只占用了其中的446个字节，另外的64个字节交给了 DPT（Disk Partition Table硬盘分区表），最后两个字节“55，AA”是分区的结束标志。这个整体构成了硬盘的主引导扇区。
位于整个硬盘的0柱面0磁头1扇区(可以看作是硬盘的第一个扇区)，bios在执行自己固有的程序以 后就会jump到mbr中的第一条指令。将系统的控制权交由mbr来执行。在总共512byte的主引导记录中，MBR的引导程序占了其中的前446个字 节(偏移0H~偏移1BDH)，随后的64个字节(偏移1BEH~偏移1FDH)为DPT(Disk PartitionTable，硬盘分区表)，最后的两个字节“55 AA”(偏移1FEH~偏移1FFH)是分区有效结束标志。

mbr是主引导记录磁盘格式，此格式在磁盘中专门分出一块扇区来记录磁盘分区信息。最大可支持2.2T的磁盘容量，分区无限。
GPT是全局统一标识符磁盘格式，分区信息是存储在一个保留分区中，不需要引导扇区，最大支持64E容量，128个分区。gpt都是主分区。

讲清楚是一件不容易的事情， 如何规划逻辑主线、展开分析是一门艺术
-->
